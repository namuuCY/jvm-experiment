# [2B] Josephus ë¬¸ì œì—ì„œì˜ JVM ì˜µì…˜ íŠœë‹

- Josephus ë¬¸ì œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë§ì€ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ì‚­ì œí•´ì•¼ í•˜ëŠ” ìƒí™©ì„ ê°€ì§€ëŠ” ë¬¸ì œ í’€ì´ë¥¼ ê°–ìŠµë‹ˆë‹¤.
  - `List`ì˜ `remove()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ í†µí•´, GC ì‹¤í—˜ì— ë¶€í•©í•˜ë„ë¡ ë¯¸ë¦¬ ì½”ë“œë¥¼ ì‘ì„±í•´ë†“ì•˜ìŠµë‹ˆë‹¤.
  - êµ¬í˜„ì²´ëŠ” `LinkedList`ë¡œ, `remove()` ë©”ì„œë“œë¥¼ í†µí•´ ê°ì²´ë¥¼ ì‚­ì œ ì‹œ, ë…¸ë“œ ê°ì²´ë¥¼ ê³„ì† ì‚­ì œ/ì°¸ì¡°í•´ì œ í•˜ë¯€ë¡œ GC ë¶€í•˜ í…ŒìŠ¤íŠ¸ì— ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.
  - `List`ì— ì‚½ì…, ì‚­ì œë˜ëŠ” `Person` ê°ì²´ëŠ” ì˜ë„ì ìœ¼ë¡œ 1kbì˜ `Byte[]` ê°ì²´ë¥¼ ê°€ì§ìœ¼ë¡œì¨ GC ë¶€í•˜ê°€ ì¢€ ë” ì˜ ì¼ì–´ë‚˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. 
- ì„±ëŠ¥ì„ ê°€ë¥´ëŠ” í•µì‹¬ì€ GCê°€ ì–¼ë§ˆë‚˜ íš¨ìœ¨ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ”ê°€? ì— ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.
- ì´ë¥¼ ì¡°ì •í•˜ëŠ” ëª‡ ê°€ì§€ ì˜µì…˜ì„ ê°€ì§€ê³  íŠœë‹ ì‹¤í—˜ì„ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.


### Josephus ê³µí†µ ì‹¤í—˜ í™˜ê²½
- n = 200000, k = 3
    - 1ë¶„ ì´í•˜, ì‹¤í—˜ì„ ìœ„í•œ ì ì ˆí•œ ì‹œê°„ëŒ€ë¥¼ ìœ„í•˜ì—¬ ì„ ì •í•œ íŒŒë¼ë¯¸í„° ì…ë‹ˆë‹¤.
- JVM ì˜µì…˜
    - `-Xms220m -Xmx220m` : heap ë©”ëª¨ë¦¬ê°€ ì ì ˆíˆ ì‘ì•„ì•¼ GCê°€ ìœ ì˜ë¯¸í•˜ê²Œ ë§ì´ ì¼ì–´ë‚˜ê³ , ì˜ ê´€ì°°ëœë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.
      - Baseline ê¸°ì¤€ GCê°€ 20~30ë²ˆ / FullGC ëŠ” 2~3ë²ˆ ì •ë„ ë‚˜ì˜¤ëŠ” heap ì‚¬ì´ì¦ˆë¥¼ ì±„íƒí•©ë‹ˆë‹¤.
    - `-XX:+PrintFlagsFinal` : JVM ì˜µì…˜ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
        - í”Œë«í¼(OS), í˜¹ì€ Intellij ì—ì„œ ë¶ˆí•„ìš”í•œ ì˜µì…˜ì„ ë„£ì–´ ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ ìƒê¸°ì§€ ì•Šë„ë¡, ì˜µì…˜ì„ í•­ìƒ í™•ì¸í•©ë‹ˆë‹¤.
    - `-XX:-TieredCompilation` : ì¡°ì‚¬ ê²°ê³¼ JITì˜ Compile ìµœì í™”ì—ëŠ” ìˆ˜ë§ì€ ìš”ì†Œê°€ ë“¤ì–´ê°€ëŠ” ê²ƒìœ¼ë¡œ ìƒê°ë©ë‹ˆë‹¤. JIT íŠœë‹ì„ ìœ„í•´ ì œê°€ ë„£ì€ ì˜µì…˜ì´ ì˜ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ ë³€ì¸ì„ í†µì œí•˜ê¸° ìœ„í•´ ì„¤ì •í•©ë‹ˆë‹¤.
        - ì´ˆê¸° ì„¤ì • ì˜¤ë¥˜(IDE ì£¼ì… ì˜µì…˜)ë¥¼ ì œê±°í•˜ê³  C2 ì»´íŒŒì¼ëŸ¬ë¥¼ í™œì„±í™”í•˜ì ì—°ì‚° ì†ë„ê°€ ì•½ 40% í–¥ìƒë¨(ì´ˆê¸° IDEì˜ ì„¤ì •ì—ì„œëŠ” ì•½ 22ì´ˆ)ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
- **â­ï¸ OS ë ˆë²¨ì˜ ìºì‹±(Disk I/O) ë° JVM Cold Startë¡œ ì¸í•œ ë…¸ì´ì¦ˆë¥¼ ë°°ì œí•˜ê¸° ìœ„í•´, ëª¨ë“  ì‹¤í—˜ì€ 3íšŒ ë°˜ë³µ ì‹¤í–‰í•œ í›„, ê°€ì¥ ì•ˆì •í™”ëœ 3íšŒì°¨ ê²°ê³¼ë¥¼ ì¸¡ì •ê°’ìœ¼ë¡œ ì±„íƒí•©ë‹ˆë‹¤.**


### Baseline ë°ì´í„°
- Flag ì˜µì…˜ë“¤ [ğŸ”— ë§í¬](/documents/data/2B-Baseline.txt)
- ì‹¤í—˜ì„ ìœ„í•´ í‘œê¸°í•˜ëŠ” ëª‡ ê°€ì§€ ì¤‘ìš” default ì˜µì…˜
    - `UseG1GC` : true - JDK 17ì˜ ë””í´íŠ¸ GCì…ë‹ˆë‹¤.

- ê±¸ë¦° ì‹œê°„ : **45.1624 ì´ˆ**
![ì½˜ì†” ì¶œë ¥ ì´ë¯¸ì§€](/documents/images/s2-2b-baseline-console.png)
- ì‹¤ì‹œê°„ Heap ì‚¬ìš©ëŸ‰ì˜ ê·¸ë˜í”„ëŠ” ì•„ë˜ì™€ ê°™ìœ¼ë©°, ê·¸ë˜í”„ ë„ì¤‘ì— ë‚™ì°¨ê°€ ì‹¬í•œ êµ¬ê°„ì€ FullGCë¡œ ì¸í•´ ê¸´ STWê°€ ì¼ì–´ë‚œ ì‹œê°„ëŒ€ì…ë‹ˆë‹¤.
![ì „ë°˜ì ì¸ Heap ì‚¬ìš©ëŸ‰ ê·¸ë˜í”„](/documents/images/s2-2b-baseline-gc-overview.png)
- ì´ 29ë²ˆì˜ GCê°€ ì¼ì–´ë‚¬ìœ¼ë©°, G1New / G1Old / G1Full ëª¨ë‘ ë‹¤ ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤.
![GC ë¦¬ìŠ¤íŠ¸](/documents/images/s2-2b-baseline-gc-list.png)
- VisualVM ì„ í†µí•´ ì•„ë˜ì™€ ê°™ì´ GCì˜ ì´ë¦„(ì¢…ë¥˜)ë³„ë¡œ STW ì‹œê°„ì„ ì¢…í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œëŠ” ì´ì²˜ëŸ¼ ì¢…í•©ëœ GC ë‚´ì—­ì„ ì˜¬ë¦¬ê² ìŠµë‹ˆë‹¤.
  - G1Old ëŠ” 4íšŒ, ì´ 3.43ms -> í‰ê·  0.85ms
  - G1New ëŠ” 22íšŒ, ì´ 43.9ms -> í‰ê·  2ms
  - G1Full ëŠ” 3íšŒ, ì´ 78.9ms -> **í‰ê·  26.3ms ë¡œ ê°€ì¥ ì„±ëŠ¥ì— ì˜í–¥ì„ ì£¼ëŠ” GCë¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
![GC ìš”ì•½](/documents/images/s2-2b-baseline-gc-summary.png)
